We've been working in the Schr\"odinger picture where the states evolve in time, but now it will be useful to pass to the Heisenberg picture, where the states are fixed and the operators evolve in time.

In the Schr\"odinger picture, it's not obvious how our theory is Lorentz invariant. We seem to have picked out time as a special dimension when we write things down (even though we started with a Lorentz invariant theory, so our final theory is still Lorentz invariant). The operators $\phi(\vec x)$ don't depend on $t$, but the states evolve as
$$i \frac{d\ket{p}}{dt}=H\ket{p} = E_p\ket{p} \implies \ket{p(t)}= e^{-i E_pt} \ket{p(0)}.$$
In the Heisenberg picture, things are a bit better-- time dependence is moved into the operators. Denoting Heisenberg picture operators as $O_H$ and Schr\"odinger picture operators as $O_S$, we have\footnote{Here, the exponential of an operator is simply defined in terms of the power expansion of $e$, e.g. $e^{iHt}=\sum_{n=0}^\infty \frac{(iHt)^n}{n!}$.}
$$O_H(t) \equiv e^{iHt}O_S e^{-iHt}.$$
Taking the time derivative of each side, one finds that
$$\frac{dO_H}{dt}=i[H,O_H].$$
It's clear that $O_H(t=0)=O_S$, so our operators agree at $t=0$ (but in general nowhere else).\footnote{It doesn't matter for the Hamiltonian itself what picture we're in, since $e^{iHt}H e^{-iHt}=H$. So $H_S=H_H$.} The field commutators then become \emph{equal time commutation relations}:
$$[\phi(\vec x,t),\phi(\vec y, t)]=[\pi(\vec x, t), \pi(\vec y,t)]=0$$
and
$$[\phi(\vec x, t), \pi (\vec y, t)]=i \delta^3(\vec x-\vec y).$$

\begin{ex}
One should check (exercise) that $\frac{d\phi}{dt}=i[H,\phi]$ now means that the Heisenberg picture operator $\phi_H$ satisfies the Klein-Gordon equation, $\p_\mu \p^\mu \phi+ m^2 \phi=0$.
\end{ex}
We now write the Fourier transform of $\phi(x)$ (where $x$ is now a four-vector) by deriving
$$d^{iHt}a_{\pv} e^{-iHt}=e^{-iE_p t} a_{\pv}$$
and
$$d^{iHt}a_{\pv}^\dagger e^{-iHt}=e^{+iE_p t} a_{\pv}^\dagger.$$
You should also check this (exercise) using the commutation relation $[H,a_{\pv}]=-E_p a_{\pv}$.

Therefore we can now write
$$\phi(\vec x, t)=\int \frac{d^3p}{(2\pi)^3} \frac{1}{\sqrt{2E_p}} \set{ a_{\pv} e^{-i p\cdot x}+a_{\pv}^\dagger e^{+i p\cdot x}}$$
where $x$ and $p$ are now four-vectors and $p_0= E_p$.

\subsection*{Causality} We might be concerned about the causal structure of this theory, since $\phi$ and $\pi$ satisfy equal-time commutation relations. In general a Lorentz transform might mix up events which in one frame take place at ``equal times.'' So what about arbitrary space-time separations? It turns out that causality requires that the commutators of spacelike separated operators is zero, i.e. two events which are spacelike separated cannot impact one another.
$$[O_1(x),O_2(y)]=0 \forall (x-y)^2 <0.$$

Does this condition hold? Let's define
$$\Delta(x-y)\equiv [\phi(x),\phi(y)]$$
and expand in the Fourier basis.
\begin{eqnarray*}
\Delta(x-y) &=& \int \frac{d^3p}{(2\pi)^6} \frac{d^3p'}{\sqrt{4E_p E_{p'}}} \left([a_{\pv},a_{\pv'}^\dagger] e^{-i(p\cdot x - p' \cdot y)}+[a_{\pv}^\dagger, a_{\pv'}] e^{i(p\cdot x-p' \cdot y)}\right)\\
&=& \int \frac{d^3p}{2E_p(2\pi)^3}\left(e^{-ip\cdot (x-y)}-e^{i p' \cdot (x-y)}\right)
\end{eqnarray*}
Remarkably, this is just a $c$-number-- it's not an operator at all but a (classical) number. It is Lorentz invariant since the integration measure $d^3p/(2E_p)$ is and the integrand is (it depends on $p\cdot (x-y)$, so totally contracted). Moreover, each term is separately Lorentz invariant. In addition, if $x-y$ is spacelike then $x-y$ can be Lorentz transformed to $y-x$ in the first term, giving $0$. It does not vanish for timelike separations, e.g.
$$[\phi (\vec x,0), \phi(\vec x,t)] = \int \frac{d^3p}{(2\pi)^3 2 E_p}(e^{-imt}-e^{+imt})\neq 0.$$
And at equal times 
$$[\phi(\vec x,t),\phi(\vec y, t)]=\int \frac{d^3p}{(2\pi)^3 2E_p}(e^{i\vec p \cdot (\vec x - \vec y)}- e^{-i \vec p \cdot (\vec x- \vec y)})=0$$
(since we can send the integration variable $\vec p\to -\vec p$). One can also see in this way that the commutator for spacelike separated operators vanishes, since a general spacelike separation can always be transformed into a frame where the two events take place at equal times.

\begin{defn}
We can then introduce the idea of a \term{propagator}-- if we initially prepare a particle at point $y$, what is the amplitude to find it at $x$? We can write this as
\begin{eqnarray*}
\bra{0}\phi(x) \phi(y)\ket{0}&=&\int \frac{d^3p d^3 p'}{(2\pi)^6\sqrt{4 E_p E_{p'}}} \bra{0} a_{\pv} a_{\pv'}^\dagger \ket{0}e^{-ip \cdot x +i p'\cdot y}\\
&=&\int \frac{d^3p d^3 p'}{(2\pi)^6\sqrt{4 E_p E_{p'}}} \bra{0} [a_{\pv} a_{\pv'}^\dagger] \ket{0}e^{-ip \cdot x +i p'\cdot y}\\
&=&\int \frac{d^3p}{(2\pi)^3 2 E_p}e^{-ip\cdot (x-y)} \equiv D(x-y),
\end{eqnarray*}
where we have used the fact that $a_{\pv}$ kills the ground state (so we can freely subtract off $a_{\pv'}^\dagger a_{\pv}$ to get a commutator) and used the resulting delta function to integrate over $d^3p'$.
\end{defn}

In fact, one can show\footnote{The easiest way to do this is to set $y=0$ and take $x$ and $y$ at equal times, $x^0=y^0=0$. This gets rid of $p^0$, and from here you can switch to spherical coordinates, rewriting $\vec p \cdot (x)$ as $|p||x|\cos\theta$.} that for spacelike separations $(x-y)^2<0,$ the propagator decays as $D(x-y)\sim e^{-m|\vec x-\vec y|}.$ The quantum field seems to ``leak'' out of the light cone. But we also computed that
$$\Delta(x-y)=[\phi(x),\phi(y)] =D(x-y)-D(y-x)=0$$ if $(x-y)^2<0$. We can interpret this to mean that there's no Lorentz invariant way to order the two events at $x$ and $y$. A particle can travel as easily from $y\to x$ as $x\to y$, so in a quantum measurement these two amplitudes cancel. With a complex scalar field, the story is more interesting. We find instead that the amplitude for a particle to go from $x\to y$ is cancelled by the amplitude for an anti-particle to go from $y\to x$.\footnote{See also Wheeler's ``one-electron universe''-- \url{https://en.wikipedia.org/wiki/One-electron_universe}.} This is also the case for the real scalar field, except the particle is its own antiparticle.

\begin{defn}
We now introduce the \term{Feynman propagator} $\Delta_F$, which is like a regular propagator but with time ordering baked in. That is,
$$\Delta_F =\begin{cases}
  \bra{0}\phi(x)\phi(y)\ket{0} & \text{for } x^0 > y^0\\    
  \bra{0}\phi(y)\phi(x)\ket{0} & \text{for } y^0 > x^0.
\end{cases}$$
\end{defn}


We claim the Feynman propagator can also be written as
$$\Delta_F =\int \frac{d^4p}{(2\pi)^4}\frac{i}{p^2-m^2}e^{-ip\cdot (x-y)}.$$
Note that this is Lorentz invariant-- the volume element is certainly Lorentz invariant, and everything else is scalars. But there's an issue-- this integral has a pole whenver $p^2=m^2$, or equivalently for each value of $\pv$, $p^2-m^2=(p^0)^2-\pv^2-m^2=0$ when $p^0= \pm E_{\pv}=\pm \sqrt{ \pv^2+m^2}$. We would like to integrate over $p^0$ to recover the earlier form of the propagator, so we can either deform the contour or push the poles of the real $p^0$ axis with an \term{$i\epsilon$ prescription}.

We'll finish the proof next time, but by analytically continuing $p^0$ to the complex plane, making this $i\epsilon$ prescription, and closing the contour appropriately we can do the $p^0$ integral and find that what we get is exactly the Feynman propagator as defined earlier in terms of time ordering.